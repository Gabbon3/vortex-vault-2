<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vault</title>
    <link rel="icon" type="image/x-icon" href="./img/vortex_vault_logo.ico">
    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
    <!-- stile -->
    <link rel="stylesheet" href="./css/main.css">
    <!-- componenti -->
    <script type="module" src="./components/main.components.js"></script>
    <!-- js -->
    <script type="module" src="./js/vault.ui.js"></script>
    <script type="module" src="./js/backup.ui.js"></script>
    <script type="module" src="./js/auth.ui.js"></script>
</head>
<body>
    <vortex-navbar></vortex-navbar>
    <main class="pagina">
        <h1 class="icon">
            <span class="material-symbols-rounded">encrypted</span>
            Vault
        </h1>
        <hr>
        <div class="isle bg-2 mb-2">
            <label for="search-vault">
                <span class="material-symbols-rounded">search</span>
                Search
            </label>
            <div class="flex gap-75">
                <input type="text" class="input-text" id="search-vault" autocomplete="off" required>
                <button class="btn t CA del-val" data-target-del="search-vault" type="button">
                    <span class="material-symbols-rounded">backspace</span>
                </button>
            </div>
        </div>
        <div class="flex gap-50 wrap">
            <!-- Sync & New Vault -->
            <div class="flex gap-50">
                <button class="btn primary" id="btn-sync-vault">
                    <span class="material-symbols-rounded">sync_alt</span>
                    Sync
                </button>
                <button class="btn primary open" data-target-open="win-create-vault">
                    <span class="material-symbols-rounded">add</span>
                    New Vault
                </button>
            </div>
            <!-- Order Buttons -->
            <div class="flex gap-50 last">
                <button class="btn secondary order-vaults" order="az" active="false">
                    <span class="material-symbols-rounded">title</span>
                    <span class="material-symbols-rounded">sort</span>
                </button>
                <button class="btn secondary order-vaults" order="date" active="false">
                    <span class="material-symbols-rounded">calendar_today</span>
                    <span class="material-symbols-rounded">sort</span>
                </button>
            </div>
        </div>
        <div id="vaults-list">
            <!-- ... -->
        </div>
    </main>
    <!-- 
    CREATE VAULT
    -->
    <div class="window m pr" id="win-create-vault">
        <div class="flex y-center">
            <h2 class="icon">
                <span class="material-symbols-rounded">encrypted_add</span>
                New Vault
            </h2>
            <button class="btn t close l last" data-target-close="win-create-vault">
                <span class="material-symbols-rounded">close</span>
            </button>
        </div>
        <!-- FORM -->
        <form id="form-create-vault">
            <div class="isle bg-3 mb-2">
                <label for="titolo">
                    <span class="material-symbols-rounded">tag</span>
                    Title
                </label>
                <div class="flex gap-50">
                    <input name="T" type="text" class="input-text mono" id="titolo" autocomplete="off" required>
                    <button class="btn t CA paste-val" data-target-pa="titolo" type="button" title="Paste">
                        <span class="material-symbols-rounded">content_paste</span>
                    </button>
                </div>
            </div>
            <!-- USERNAME -->
            <div class="isle bg-3 mb-2">
                <label for="username">
                    <span class="material-symbols-rounded">person</span>
                    Username
                </label>
                <div class="flex gap-50">
                    <input name="U" type="text" class="input-text mono" list="used-username" id="username" autocomplete="off">
                    <button class="btn t CA paste-val" data-target-pa="username" type="button" title="Paste">
                        <span class="material-symbols-rounded">content_paste</span>
                    </button>
                </div>
                <datalist id="used-username"></datalist>
            </div>
            <!-- PASSWORD -->
            <div class="isle bg-3 mb-2">
                <label for="password">
                    <span class="material-symbols-rounded">key_vertical</span>
                    Password
                </label>
                <div class="flex gap-50 mb-2">
                    <input name="P" type="text" class="input-text mono" id="password" autocomplete="off" required>
                    <button class="btn t CA paste-val" data-target-pa="password" type="button" title="Paste">
                        <span class="material-symbols-rounded">content_paste</span>
                    </button>
                </div>
                <password-strength-bar class="m-0" xs="true" value="100" id="create-psw-strength-bar" input-id="password"></password-strength-bar>
            </div>
            <!-- CUSTOM -->
            <div class="custom-sections flex d-column" id="custom-sections-new-vault">
                <!-- ... -->
            </div>
            <!-- NOTE -->
            <div class="isle bg-3 mb-2">
                <label for="note">
                    <span class="material-symbols-rounded">info</span>
                    Note
                </label>
                <textarea name="N" id="note" autocomplete="none" class="input-text" rows="3"></textarea>
            </div>
            <hr>
            <div class="flex gap-50">
                <button type="submit" class="btn primary">
                    <span class="material-symbols-rounded">add</span>
                    Create
                </button>
                <button type="button" class="btn secondary" id="add-custom-section-new-vault">
                    <span class="material-symbols-rounded">variable_add</span>
                    Custom section
                </button>
            </div>
        </form>
    </div>
    <!-- 
    UPDATE VAULT
    -->
    <div class="window m" id="win-update-vault">
        <div class="flex y-center">
            <h2 class="icon">
                <span class="material-symbols-rounded">edit</span>
                <span id="vault-title-to-update">Null</span>
            </h2>
            <button class="btn t close l last" data-target-close="win-update-vault">
                <span class="material-symbols-rounded">close</span>
            </button>
        </div>
        <!-- FORM -->
        <form id="form-update-vault">
            <input type="text" class="none" id="update-vault-id" name="vault_id" value="*">
            <div class="isle bg-3 mb-2">
                <label for="update-titolo">
                    <span class="material-symbols-rounded">tag</span>
                    Title
                </label>
                <div class="flex gap-75">
                    <input name="T" type="text" class="input-text mono" id="update-titolo" autocomplete="off" required>
                    <button class="btn t CA copy-val" data-target-cc="update-titolo" type="button" title="Copy">
                        <span class="material-symbols-rounded">content_copy</span>
                    </button>
                </div>
            </div>
            <!-- USERNAME -->
            <div class="isle bg-3 mb-2">
                <label for="update-username">
                    <span class="material-symbols-rounded">person</span>
                    Username
                </label>
                <div class="flex gap-75">
                    <input name="U" type="text" class="input-text mono" id="update-username" autocomplete="off">
                    <button class="btn t CA copy-val" data-target-cc="update-username" type="button" title="Paste">
                        <span class="material-symbols-rounded">content_copy</span>
                    </button>
                </div>
            </div>
            <!-- PASSWORD -->
            <div class="isle bg-3 mb-2">
                <label for="update-password">
                    <span class="material-symbols-rounded">key_vertical</span>
                    Password
                </label>
                <div class="flex gap-75 mb-2">
                    <input name="P" type="text" class="input-text mono" id="update-password" autocomplete="off" required>
                    <button class="btn t CA copy-val" data-target-cc="update-password" type="button" title="Paste">
                        <span class="material-symbols-rounded">content_copy</span>
                    </button>
                </div>
                <password-strength-bar class="m-0" id="update-psw-strength-bar" xs="true" input-id="update-password"></password-strength-bar>
            </div>
            <!-- CUSTOM -->
            <div class="custom-sections flex d-column" id="custom-sections-update-vault">
                <!-- ... -->
            </div>
            <!-- NOTE -->
            <div class="isle bg-3 mb-2">
                <label for="update-note">
                    <span class="material-symbols-rounded">info</span>
                    Note
                </label>
                <textarea name="N" id="update-note" autocomplete="none" class="input-text" rows="3"></textarea>
            </div>
            <div class="flex gap-50 wrap mt-2 isle bg-3">
                <label class="isle bg-1 fg-1 icon m-0" title="Vault Created Date">
                    <span class="material-symbols-rounded">calendar_add_on</span>
                    <span id="update-created-date">Null</span>
                </label>
                <label class="isle bg-1 fg-1 icon m-0" title="Vault Last Update Date">
                    <span class="material-symbols-rounded">edit_calendar</span>
                    <span id="update-last-modified-date">Null</span>
                </label>
            </div>
            <hr>
            <div class="flex gap-50">
                <button type="submit" class="btn primary">
                    <span class="material-symbols-rounded">edit</span>
                    Edit
                </button>
                <button type="button" class="btn secondary" id="add-custom-section-update-vault">
                    <span class="material-symbols-rounded">variable_add</span>
                    Custom section
                </button>
                <button type="button" vault-id="" id="btn-delete-vault" class="btn danger last">
                    <span class="material-symbols-rounded">delete_forever</span>
                    Delete
                </button>
            </div>
        </form>
    </div>
    <!-- 
    DEVICES
    -->
    <div class="window m pl" id="win-devices">
        <div class="flex y-center">
            <h2 class="icon">
                <span class="material-symbols-rounded">token</span>
                Devices
                <span class="material-symbols-rounded warning">vpn_key</span>
            </h2>
            <button class="btn t close l last" data-target-close="win-devices">
                <span class="material-symbols-rounded">close</span>
            </button>
        </div>
        <hr>
        <p>
            In this section you can control the access of devices connected to your account. <br>
            The <b>highlighted</b> device represents the current one.
        </p>
        <div class="flex gap-50 mb-2">
            <button class="btn primary" id="btn-sync-devices">
                <span class="material-symbols-rounded">sync_alt</span>
                Sync
            </button>
        </div>
        <div id="devices-list">
            <!-- ... -->
        </div>
    </div>
    <!-- 
    BACKUP
    -->
    <div class="window m pl" id="win-backups">
        <div class="flex y-center">
            <h2 class="icon">
                <span class="material-symbols-rounded">cloud</span>
                Backup
            </h2>
            <button class="btn t close l last" data-target-close="win-backups">
                <span class="material-symbols-rounded">close</span>
            </button>
        </div>
        <hr>
        <h3 class="icon">
            <span class="material-symbols-rounded">database</span>
            Server
            <span class="material-symbols-rounded warning">vpn_key</span>
        </h3>
        <p>
            You can save only one backup at time on server
        </p>
        <div class="isle bg-4 flex gap-50">
            <button class="btn primary fg-1" id="btn-create-backup">
                <span class="material-symbols-rounded">add</span>
                Generate
            </button>
            <button class="btn warning fg-1" id="btn-restore-backup-server">
                <span class="material-symbols-rounded">settings_backup_restore</span>
                Restore
            </button>
        </div>
        <hr>
        <h3 class="icon">
            <span class="material-symbols-rounded">hard_drive</span>
            Download
        </h3>
        <form class="isle bg-4 mb-2" id="form-create-backup-locally">
            <label for="backup-custom-password">
                <span class="material-symbols-rounded">key_vertical</span>
                Custom password
            </label>
            <input type="password" name="key" id="backup-custom-password" class="input-text mb-2"  placeholder="* * *">
            <label for="backup-custom-password-">
                <span class="material-symbols-rounded">key_vertical</span>
                Repeat custom password
            </label>
            <input type="password" name="key_r" id="backup-custom-password-" class="input-text mb-2"  placeholder="* * *">
            <p class="description">
                Leave blank if you want to use the default master key.
            </p>
            <button type="submit" class="btn primary">
                <span class="material-symbols-rounded">download</span>
                Generate & Download
            </button>
        </form>
        <h3 class="icon">
            <span class="material-symbols-rounded">draft</span>
            Restore locally
            <span class="material-symbols-rounded warning">vpn_key</span>
        </h3>
        <form id="form-restore-backup-from-file" class="isle bg-4">
            <label for="backup-file">
                <span class="material-symbols-rounded">draft</span>
                Backup file
            </label>
            <input type="file" id="backup-file" name="backup_file" class="input-text" accept=".bin" required>
            <p class="description">
                .bin file
            </p>
            <!-- --- -->
            <label for="backup-custom-password-restore">
                <span class="material-symbols-rounded">key_vertical</span>
                Custom password
            </label>
            <input type="password" name="key" id="backup-custom-password-restore" class="input-text mb-2" placeholder="* * *">
            <p class="description">
                Leave blank if you had not used a custom password for backup.
            </p>
            <button class="btn warning" id="btn-restore-backup-locally">
                <span class="material-symbols-rounded">settings_backup_restore</span>
                Restore
            </button>
        </form>
    </div>
    <!-- PSW GENERATOR -->
    <div class="window m pr" id="win-psw-generator">
        <div class="flex y-center">
            <h2 class="icon">
                <span class="material-symbols-rounded">key_vertical</span>
                Generator
            </h2>
            <button class="btn t close l last" data-target-close="win-psw-generator">
                <span class="material-symbols-rounded">close</span>
            </button>
        </div>
        <hr>
        <colored-password class="l mb-2" id="psw-generator-tester"></colored-password>
        <!-- strength bar -->
        <password-strength-bar class="fs-l" value="100" id="psw-gen-str-bar" input-id="psw-generator-tester"></password-strength-bar>
        <!-- actions -->
        <div class="flex gap-50 d-row y-center">
            <div class="flex gap-50">
                <button class="btn t CA copy-val" data-target-cc="psw-generator-tester" title="Copy">
                    <span class="material-symbols-rounded">content_copy</span>
                </button>
                <button class="btn t CA paste-val" data-target-pa="psw-generator-tester" title="Paste">
                    <span class="material-symbols-rounded">content_paste</span>
                </button>
                <button class="btn t CA del-val" data-target-del="psw-generator-tester" title="Cancel">
                    <span class="material-symbols-rounded">backspace</span>
                </button>
            </div>
            <!-- --- -->
        </div>
        <form id="form-psw-gen">
            <!-- length -->
            <div class="flex gap-50 y-center">
                <label for="psw-gen-len"><monospace>Length</monospace></label>
                <monospace id="psw-gen-length-indicator" class="fs-l last">12</monospace>
            </div>
            <input type="range" name="length" min="1" max="32" value="12" step="1" class="" id="psw-gen-len">
            <!-- types -->
            <div class="flex gap-50 d-row mb-2">
                <div class="flex d-column fg-1">
                    <div class="flex gap-100 d-row y-center">
                        <div class="input-switch">
                            <input type="checkbox" id="psw-gen-az" name="az" checked>
                            <label for="psw-gen-az"></label>
                        </div>
                        <monospace>a-z</monospace>
                    </div>
                    <div class="flex gap-100 d-row y-center">
                        <div class="input-switch">
                            <input type="checkbox" id="psw-gen-AZ" name="AZ" checked>
                            <label for="psw-gen-AZ"></label>
                        </div>
                        <monospace>A-Z</monospace>
                    </div>
                </div>
                <div class="flex d-column fg-1">
                    <div class="flex gap-100 d-row y-center">
                        <div class="input-switch">
                            <input type="checkbox" id="psw-gen-09" name="_09" checked>
                            <label for="psw-gen-09"></label>
                        </div>
                        <monospace>0-9</monospace>
                    </div>
                    <div class="flex gap-100 d-row y-center">
                        <div class="input-switch">
                            <input type="checkbox" id="psw-gen-_s" name="_$" checked>
                            <label for="psw-gen-_s"></label>
                        </div>
                        <monospace>!-?</monospace>
                    </div>
                </div>
            </div>
            <!-- submit -->
            <button type="submit" class="btn primary w-100">
                <span class="material-symbols-rounded">sync</span>
                Generate
            </button>
        </form>
        
    </div>
    <!-- 
    SETTINGS
    -->
    <div class="window m pl" id="win-settings">
        <div class="flex y-center">
            <h2 class="icon">
                <span class="material-symbols-rounded">settings</span>
                Settings
            </h2>
            <button class="btn t close l last" data-target-close="win-settings">
                <span class="material-symbols-rounded">close</span>
            </button>
        </div>
        <hr>
        <!-- MFA -->
        <h3 class="icon slider" slider="cont-mfa">
            <span class="material-symbols-rounded">phonelink_lock</span>
            MFA
            <span class="material-symbols-rounded warning" title="Email verification required">id_card</span>
        </h3>
        <div id="cont-mfa" class="isle bg-3" style="display: none;">
            <p>
                Enable the secondary authentication feature to protect your account.
            </p>
            <form id="form-new-mfa-secret">
                <email-verify-btn target-id="code-new-mfa-secret"></email-verify-btn>
                <label for="code-new-mfa-secret">
                    <span class="material-symbols-rounded">password</span>
                    Code
                </label>
                <input name="code" type="text" maxlength="6" class="input-text mfa" id="code-new-mfa-secret" placeholder="******" autocomplete="off" required>
                <p class="description">
                    You must enter the code you will receive from the emails.
                </p>
                <button type="submit" class="btn primary">
                    <span class="material-symbols-rounded">security</span>
                    Enable
                </button>
            </form>
            <div class="flex gap-50">
            </div>
            <canvas id="qrcode-2fa-secret"></canvas>
        </div>
        <hr>
        <!-- SUDO SESSION -->
        <h3 class="icon slider" slider="cont-sudo-session">
            <span class="material-symbols-rounded warning">vpn_key</span>
            Sudo Session
        </h3>
        <div id="cont-sudo-session" class="isle bg-3" style="display: none;">
            <p>
                Enable sudo session to perform critical operations.
                The session will only last 20 minutes for safety reasons. <br>
                All operations that require this session are marked with this symbol
                <span class="material-symbols-rounded warning">vpn_key</span>
            </p>
            <form id="form-start-sudo-session">
                <label for="start-sudo-session-code">
                    <span class="material-symbols-rounded">password</span>
                    MFA Code
                </label>
                <div class="flex gap-75 mb-2">
                    <input name="code" maxlength="6" type="text" class="input-text mfa" id="start-sudo-session-code" autocomplete="off" placeholder="******" required>
                    <button class="btn t CA paste-val" data-target-pa="start-sudo-session-code" type="button" title="Paste">
                        <span class="material-symbols-rounded">content_paste</span>
                    </button>
                </div>
                <button type="submit" class="btn primary">
                    <span class="material-symbols-rounded">security</span>
                    Enable
                </button>
            </form>
        </div>
        <hr>
        <!-- CHANGE PASSWORD -->
        <h3 class="icon slider" slider="form-change-password">
            <span class="material-symbols-rounded">key</span>
            Change Password
            <span class="material-symbols-rounded warning" title="Sudo Session Required">vpn_key</span>
        </h3>
        <form id="form-change-password" class="isle bg-3" style="display: none;">
            <p>
                <strong>Before changing your password</strong>
                you should know that you will have to manually restore a backup, 
                which will be generated locally after the change, 
                you will have to go to the backup section and restore the 
                backup from the file you just downloaded.
            </p>
            <label for="old-password">
                <span class="material-symbols-rounded">key_vertical</span>
                Old Password
            </label>
            <input name="old_password" type="password" class="input-text mono" id="old-password" autocomplete="off" required>
            <hr>
            <label for="new-password">
                <span class="material-symbols-rounded">key_vertical</span>
                New Password
            </label>
            <input name="new_password" type="password" class="input-text mono" id="new-password" autocomplete="off" required>
            <label for="new-password-2">
                <span class="material-symbols-rounded">key_vertical</span>
                Repeat new Password
            </label>
            <input name="new_password_2" type="password" class="input-text mono" id="new-password-2" autocomplete="off" required>
            <!-- --- -->
            <div class="flex-gap-50 mt-2">
                <button type="submit" class="btn primary">
                    <span class="material-symbols-rounded">sync</span>
                    Change Password
                </button>
            </div>
        </form>
        <hr>
        <!-- RECOVERY CODE -->
        <h3 class="icon slider" slider="cont-rec-code">
            <span class="material-symbols-rounded">lock_reset</span>
            Recovery Code
            <span class="material-symbols-rounded warning" title="Sudo Session Required">vpn_key</span>
        </h3>
        <div id="cont-rec-code" class="isle bg-3" style="display: none;">
            <p>
                Generate a sudo code to help you recover your password if you forget it and to activate MFA.
                <br>
                <strong>Pay attention!</strong> If you also lose your sudo code, 
                you wouldn't be able to access your password or to generate other mfa secret also.
            </p>
            <form id="form-new-recovery-code">
                <label for="password-recovery">
                    <span class="material-symbols-rounded">key_vertical</span>
                    Password
                </label>
                <div class="flex gap-50">
                    <input name="password" type="password" class="input-text mono" id="password-recovery" autocomplete="off" required>
                    <button class="btn t CA paste-val" data-target-pa="password-recovery" type="button" title="Paste">
                        <span class="material-symbols-rounded">content_paste</span>
                    </button>
                </div>
                <p class="description">
                    You need to enter your password to perform this operation.
                </p>
                <!-- --- -->
                <div class="flex-gap-50 mt-2">
                    <button type="submit" class="btn primary">
                        <span class="material-symbols-rounded">security</span>
                        Generate Recovery Code
                    </button>
                </div>
            </form>
        </div>
        <hr>
        <!-- FAST SIGN-IN -->
        <h3 class="icon slider" slider="cont-fsi">
            <span class="material-symbols-rounded">id_card</span>
            Quick Sign-in
            <span class="material-symbols-rounded warning" title="Sudo Session Required">vpn_key</span>
        </h3>
        <div id="cont-fsi" class="isle bg-3" style="display: none;">
            <p>
                Generate a QR code for quick sign-in from another device.
            </p>
            <form id="form-fsi">
                <label for="password-fsi">
                    <span class="material-symbols-rounded">key_vertical</span>
                    Password
                </label>
                <div class="flex gap-50">
                    <input name="password" type="password" class="input-text mono" id="password-fsi" autocomplete="off" required>
                    <btn-paste target="password-fsi"></btn-paste>
                </div>
                <p class="description">
                    You need to enter your password to perform this operation.
                </p>
                <!-- --- -->
                <button type="submit" class="btn primary mt-2">
                    <span class="material-symbols-rounded">qr_code</span>
                    Generate QR Code
                </button>
            </form>
            <canvas id="qrcode-fsi"></canvas>
        </div>
        <hr>
        <div class="flex gap-50">
            <button class="btn danger" id="logout-btn">
                <span class="material-symbols-rounded">logout</span>
                Sign-out
            </button>
        </div>
    </div>
    <!-- FOOTER -->
    <vortex-footer></vortex-footer>
</body>
</html>